# アーカイブページに表示するサムネイルを、投稿の 1 つ目の画像にする（アイキャッチは使わない）

タイプ: スニペット, フロー

## 利用シーン（あれば画像）

- タイトルの通り

![image.png](%E3%82%A2%E3%83%BC%E3%82%AB%E3%82%A4%E3%83%96%E3%83%9A%E3%83%BC%E3%82%B8%E3%81%AB%E8%A1%A8%E7%A4%BA%E3%81%99%E3%82%8B%E3%82%B5%E3%83%A0%E3%83%8D%E3%82%A4%E3%83%AB%E3%82%92%E3%80%81%E6%8A%95%E7%A8%BF%E3%81%AE1%E3%81%A4%E7%9B%AE%E3%81%AE%E7%94%BB%E5%83%8F%E3%81%AB%E3%81%99%E3%82%8B%EF%BC%88%E3%82%A2%E3%82%A4%E3%82%AD%E3%83%A3%E3%83%83%E3%83%81%E3%81%AF%E4%BD%BF%E3%82%8F%E3%81%AA%E3%81%84%EF%BC%89/image.png)

## やること

1. `function.php` で、各投稿 1 つ目の画像を変数に格納

   ```scss
   /* ===============================================
   *  各投稿1つ目の画像をサムネイルとして取得する方法
   =============================================== */
   function catch_first_image() {
     global $post, $posts;
     $first_img = '';
     ob_start();
     ob_end_clean();

     // 正規表現パターンを修正
     $output = preg_match_all('/<img.+src=[\'"]([^\'"]+)[\'"].*>/i', $post->post_content, $matches);

     // matchesが存在し、かつ配列の要素が存在する場合のみ代入
     if (isset($matches[1]) && !empty($matches[1])) {
       $first_img = $matches[1][0];
     }

     // 画像が見つからない場合はデフォルト画像を設定
     if (empty($first_img)) {
       $first_img = get_theme_file_uri('assets/images/common/no-image.svg'); // ダミー画像のパスを正確に指定
     }

     return $first_img;
   }

   ```

2. サムネイルを表示したいところでは、`catch_first_image()`を使用

   ```php
   <div class="blogsItemThumbnail">
       <img src="<?php echo catch_first_image(); ?>" alt="<?php the_title(); ?>">
   </div>
   ```
