# WordPressで、expertを出力

タイプ: スニペット
技術・ツール: WordPress

## 利用シーン（あれば画像）

## コード

```php
<?php echo nl2br(esc_html(get_the_excerpt())); ?>
```

# Doc

## 💻 `nl2br`（New Line to Break）

### 📝 役割

**改行コード** (`\n`, `\r\n`など) を、HTMLの**改行タグ** (`<br />` または `<br>`) に変換します。

### 📌 なぜ使うのか

HTMLでは、ソースコード中の改行は通常無視され、連続するスペースとして扱われます。ユーザーがテキストエリアに入力した文章や、データベースに保存されている改行を含むテキストをウェブページに表示する際、その改行をブラウザ上でも視覚的な改行として反映させるために使用します。

---

## 🔒 `esc_html`（Escape HTML）

### 📝 役割

文字列中の特定のHTML特殊文字を、その**エンティティ**（実体参照）に変換します。これは主にセキュリティ対策として行われます。

- `<` (小なり記号) $\rightarrow$ `&lt;`
- `>` (大なり記号) $\rightarrow$ `&gt;`
- `&` (アンパサンド) $\rightarrow$ `&amp;`
- `"` (ダブルクォート) $\rightarrow$ `&quot;`
- `'` (シングルクォート) $\rightarrow$ `&#039;`

### 📌 なぜ使うのか

ユーザーが入力したデータや、外部から取得したデータに**悪意のあるHTMLタグ**や**JavaScriptコード**（例：`<script>alert('XSS攻撃')</script>`）が含まれていた場合、そのまま出力するとブラウザがそれを実行してしまう可能性があります。これを**クロスサイト・スクリプティング (XSS)** 攻撃と呼びます。

`esc_html`を使うことで、タグとして認識されるべき記号を無害な文字列として変換し、ブラウザに**単なるテキスト**として表示させるようにします。これにより、セキュリティリスクを防ぎます。

---

## ⚙️ コード全体の流れ

`<?php echo nl2br(esc_html(get_the_excerpt())); ?>`

1. **`get_the_excerpt()`**: WordPressの機能で、投稿の**抜粋**（テキスト）を取得します。
2. **`esc_html(...)`**: 取得した抜粋テキストに対し、**セキュリティ処理**（HTMLエスケープ）を行います。これにより、悪意のあるHTMLやスクリプトが無効化されます。
3. **`nl2br(...)`**: セキュリティ処理が完了したテキストに対し、テキスト内の**改行を`<br />`タグに変換**し、表示時に改行が効くようにします。
4. **`echo`**: 最終的に処理された文字列をウェブページに出力（表示）します。

この順序は非常に重要です。先に改行を`<br />`に変換してから`esc_html`を適用してしまうと、意図した`<br />`タグまでエスケープされてしまい、改行が表示されなくなってしまいます。**セキュリティ処理を先に**行うのが正しい使い方です。